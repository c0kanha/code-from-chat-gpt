IDENTIFICATION DIVISION.
PROGRAM-ID. DynamicSQLExample.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-SQL-STATEMENT   PIC X(100).
01 WS-SQL-LENGTH      PIC S9(4) COMP.

01 WS-HOST-VARIABLE-1 PIC X(10).
01 WS-HOST-VARIABLE-2 PIC X(20).

01 SQLCA.
   05 SQLCAID          PIC X(8)  VALUE 'SQLCA'.
   05 SQLCABC          PIC S9(9)  COMP.
   05 SQLCODE          PIC S9(9)  COMP.
   05 SQLERRM          PIC X(70).
   05 SQLERRD          PIC S9(9)  COMP OCCURS 6 TIMES.

EXEC SQL
  INCLUDE SQLCA
END-EXEC.

EXEC SQL
  DECLARE DB2CURSOR CURSOR FOR S1
END-EXEC.

PROCEDURE DIVISION.
MAIN-LOGIC.

  MOVE 'SELECT COLUMN1, COLUMN2 FROM YOUR_TABLE WHERE CONDITION' TO WS-SQL-STATEMENT
  MOVE LENGTH OF WS-SQL-STATEMENT TO WS-SQL-LENGTH.

  EXEC SQL
    OPEN DB2CURSOR USING :WS-SQL-STATEMENT
  END-EXEC.

  PERFORM UNTIL SQLCODE NOT = 0
    EXEC SQL
      FETCH DB2CURSOR INTO :WS-HOST-VARIABLE-1, :WS-HOST-VARIABLE-2
    END-EXEC.

    IF SQLCODE = 0
      DISPLAY 'Data retrieved:'
      DISPLAY 'Column 1: ' WS-HOST-VARIABLE-1
      DISPLAY 'Column 2: ' WS-HOST-VARIABLE-2
    END-IF
  END-PERFORM.

  EXEC SQL
    CLOSE DB2CURSOR
  END-EXEC.

  IF SQLCODE = 100
    DISPLAY 'No more rows to fetch.'
  END-IF.

  STOP RUN.
